pipeline {
    agent any
    environment {
        DJANGO_SUPERUSER_EMAIL="nganadmin@gmail.com"
        IMAGE_NAME="task-master"
        REGISTRY_NAMESPACE="nganlt27"
    }
    stages {
        // stage('Build'){
        //     steps {
        //         echo "Building image..."
        //         withCredentials([usernamePassword(credentialsId: 'DJANGO_SUPERUSER', passwordVariable: 'DJANGO_SUPERUSER_PASSWORD', usernameVariable: 'DJANGO_SUPERUSER_USERNAME')]) {
        //             sh "docker-compose up --build --no-start"
        //         }

        //         echo "Uploading image..."
        //         withCredentials([usernamePassword(credentialsId: 'DOCKER_HUB_ACCOUNT', passwordVariable: 'PASSWORD', usernameVariable: 'USERNAME')]) {
        //             sh "echo ${PASSWORD} | docker login --username ${USERNAME} --password-stdin"
        //             sh '''
        //                 docker tag ${IMAGE_NAME}:${BUILD_NUMBER} ${REGISTRY_NAMESPACE}/${IMAGE_NAME}:${BUILD_NUMBER}
        //                 docker tag ${IMAGE_NAME}:${BUILD_NUMBER} ${REGISTRY_NAMESPACE}/${IMAGE_NAME}:latest
                        
        //                 docker push ${REGISTRY_NAMESPACE}/${IMAGE_NAME}:${BUILD_NUMBER}
        //                 docker push ${REGISTRY_NAMESPACE}/${IMAGE_NAME}:latest
        //             '''
        //         }
        //     }
        // }

        stage('JIRA') {
            steps{
                script {
                    withEnv(['JIRA_SITE=JIRA-Test']) {
                    def comment = [ body: 'Test comment from Jenkins' ]
                    jiraAddComment idOrKey: 'TASK-1', input: comment
                    }
                }
            }
        }
    }
}

